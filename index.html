<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <form id="myForm" onsubmit="savetolocalstorage(event)">
      <label for="">Name</label>
      <input type="text" id="username" name="username" />
      <label>Email id</label>
      <input type="email" id="email" name="emailId" />
      <label for="">phone number</label>
      <input type="tel" id="phone" name="phone" />
      <button>submit</button>
    </form>

    <ul id="listofusers"></ul>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
    <script>
      function savetolocalstorage(event) {
        event.preventDefault();
        const name = event.target.username.value;
        const email = event.target.emailId.value;
        const phone = event.target.phone.value;
        const obj = {
          name,
          email,
          phone,
        };
        axios
          .post(
            "https://crudcrud.com/api/e2b8d7f3e7e04cbb9cca59b51863f7e1/appointment",
            obj
          )
          .then((response) => {
            console.log(response);
          })
          .catch((err) => {
            console.log(err);
          });
        document.getElementById("myForm").reset();
        location.reload();
      }
      window.addEventListener("DOMContentLoaded", () => {
        axios
          .get(
            "https://crudcrud.com/api/e2b8d7f3e7e04cbb9cca59b51863f7e1/appointment"
          )
          .then((response) => {
            // console.log(response);
            for (var i = 0; i < response.data.length; i++) {
              showOutput(response.data[i]);
            }
          })
          .catch((err) => {
            console.log(err);
          });
      });

      function showOutput(user) {
        const list = document.getElementById("listofusers");
        let li = document.createElement("li");
        let del = document.createElement("button");
        del.setAttribute("id", `${user._id}`);
        const id = `${user._id}`;
        const name = `${user.name}`;
        const email = `${user.email}`;
        const phone = `${user.phone}`;

        let obj = {
          id: id,
          name: name,
          email: email,
          phone: phone,
        };
        del.setAttribute("onclick", `delete1(id)`);
        let edit = document.createElement("button");
        edit.setAttribute("id", `${user._id}`);
        edit.setAttribute("onclick", `edit1(id)`);

        del.innerHTML = "delete";
        edit.innerHTML = "Edit";
        li.innerHTML = `${user.name}- ${user.email} - ${user.phone}`;
        list.appendChild(li);
        list.appendChild(del);
        list.appendChild(edit);
      }
      function delete1(id) {
        console.log(id);
        // alert("delete !");
        axios
          .delete(
            `https://crudcrud.com/api/e2b8d7f3e7e04cbb9cca59b51863f7e1/appointment/` +
              id
          )
          .then((response) => {
            console.log(response);
            location.reload();
          })
          .catch((err) => {
            console.log(err);
          });
      }
      function edit1(id) {
        console.log(id);
        let data;
        axios
          .get(
            `https://crudcrud.com/api/e2b8d7f3e7e04cbb9cca59b51863f7e1/appointment/` +
              id
          )
          .then((response) => {
            // alert("welcome");
            data = response;
            // console.log(data.data._id);
            let name = document.createElement("input");
            name.setAttribute("type", "text");
            name.setAttribute("id", "name2");
            name.setAttribute("value", `${data.data.name}`);
            document.body.appendChild(name);
            let email = document.createElement("input");
            email.setAttribute("type", "email");
            email.setAttribute("id", "email2");
            email.setAttribute("value", `${data.data.email}`);
            document.body.appendChild(email);

            let phone = document.createElement("input");
            phone.setAttribute("type", "text");
            phone.setAttribute("id", "phone2");
            phone.setAttribute("value", `${data.data.phone}`);
            document.body.appendChild(phone);
            let id = `${data.data._id}`;
            let sb = document.createElement("input");
            sb.setAttribute("type", "button");
            sb.setAttribute("id", "update11");
            sb.setAttribute("value", `Submit`);

            document.body.appendChild(sb);

            const element = document.getElementById("update11");
            element.addEventListener("click", function () {
              console.log("Clicked");
              const nam = document.getElementById("name2").value;
              const emai = document.getElementById("email2").value;
              const phon = document.getElementById("phone2").value;
              const obj = {
                nam,
                emai,
                phon,
              };
              console.log("object  =>>>>>>>>>>>", obj);
              axios
                .patch(
                  "https://crudcrud.com/api/e2b8d7f3e7e04cbb9cca59b51863f7e1/appointment",
                  { obj, completed: true }
                )
                .then((response) => {
                  console.log(response);
                  location.reload();
                })
                .catch((err) => {
                  console.log(err);
                });
            });
            // sb.setAttribute("onclick", `update1(id,obj)`);
          })
          .catch((err) => {
            console.log(err);
          });
      }
    </script>
  </body>
</html>
